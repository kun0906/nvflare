2024-08-15 09:27:52,167 - SimulatorRunner - INFO - Create the Simulator Server.
2024-08-15 09:27:52,168 - CoreCell - INFO - server: creating listener on tcp://0:53813
2024-08-15 09:27:52,210 - CoreCell - INFO - server: created backbone external listener for tcp://0:53813
2024-08-15 09:27:52,210 - ConnectorManager - INFO - 71739: Try start_listener Listener resources: {'secure': False, 'host': 'localhost'}
2024-08-15 09:27:52,211 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connector [CH00002 PASSIVE tcp://0:52024] is starting
2024-08-15 09:27:52,716 - CoreCell - INFO - server: created backbone internal listener for tcp://localhost:52024
2024-08-15 09:27:52,717 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connector [CH00001 PASSIVE tcp://0:53813] is starting
2024-08-15 09:27:52,773 - nvflare.fuel.hci.server.hci - INFO - Starting Admin Server localhost on Port 53814
2024-08-15 09:27:52,773 - SimulatorRunner - INFO - Deploy the Apps.
2024-08-15 09:27:52,809 - SimulatorRunner - INFO - Create the simulate clients.
2024-08-15 09:27:52,811 - ClientManager - INFO - Client: New client site-1@10.9.172.52 joined. Sent token: 7c9e7b14-d775-4a1d-81ea-8da944fbb31d.  Total clients: 1
2024-08-15 09:27:52,812 - FederatedClient - INFO - Successfully registered client:site-1 for project simulator_server. Token:7c9e7b14-d775-4a1d-81ea-8da944fbb31d SSID:
2024-08-15 09:27:52,812 - ClientManager - INFO - Client: New client site-2@10.9.172.52 joined. Sent token: 252acc1b-d25a-462f-ad05-54d60cee9fbd.  Total clients: 2
2024-08-15 09:27:52,812 - FederatedClient - INFO - Successfully registered client:site-2 for project simulator_server. Token:252acc1b-d25a-462f-ad05-54d60cee9fbd SSID:
2024-08-15 09:27:52,812 - SimulatorRunner - INFO - Set the client status ready.
2024-08-15 09:27:52,812 - SimulatorRunner - INFO - Deploy and start the Server App.
2024-08-15 09:27:52,813 - Cell - INFO - Register blob CB for channel='server_command', topic='*'
2024-08-15 09:27:52,813 - Cell - INFO - Register blob CB for channel='aux_communication', topic='*'
2024-08-15 09:27:52,813 - ServerCommandAgent - INFO - ServerCommandAgent cell register_request_cb: server.simulate_job
2024-08-15 09:27:53,191 - IntimeModelSelector - INFO - model selection weights control: {}
2024-08-15 09:27:53,191 - AuxRunner - INFO - registered aux handler for topic __sync_runner__
2024-08-15 09:27:53,191 - AuxRunner - INFO - registered aux handler for topic __job_heartbeat__
2024-08-15 09:27:53,191 - AuxRunner - INFO - registered aux handler for topic __task_check__
2024-08-15 09:27:53,192 - AuxRunner - INFO - registered aux handler for topic RM.RELIABLE_REQUEST
2024-08-15 09:27:53,192 - AuxRunner - INFO - registered aux handler for topic RM.RELIABLE_REPLY
2024-08-15 09:27:53,192 - ReliableMessage - INFO - enabled reliable message: max_request_workers=20 query_interval=2.0
2024-08-15 09:27:53,192 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job]: Server runner starting ...
2024-08-15 09:27:53,192 - AuxRunner - INFO - registered aux handler for topic fed.event
2024-08-15 09:27:53,192 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job]: starting workflow controller (<class 'nvflare.app_common.workflows.fedavg.FedAvg'>) ...
2024-08-15 09:27:53,192 - FedAvg - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: Initializing BaseModelController workflow.
2024-08-15 09:27:53,192 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: Workflow controller (<class 'nvflare.app_common.workflows.fedavg.FedAvg'>) started
2024-08-15 09:27:53,192 - FedAvg - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: Beginning model controller run.
2024-08-15 09:27:53,192 - FedAvg - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: Start FedAvg.
2024-08-15 09:27:53,192 - FedAvg - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: loading initial model from persistor
2024-08-15 09:27:53,192 - PTFileModelPersistor - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: Both source_ckpt_file_full_name and ckpt_preload_path are not provided. Using the default model weights initialized on the persistor side.
2024-08-15 09:27:53,192 - FedAvg - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: Round 0 started.
2024-08-15 09:27:53,192 - FedAvg - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: Sampled clients: ['site-1', 'site-2']
2024-08-15 09:27:53,192 - FedAvg - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: Sending task train to ['site-1', 'site-2']
2024-08-15 09:27:53,193 - WFCommServer - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: scheduled task train
2024-08-15 09:27:53,818 - SimulatorClientRunner - INFO - Start the clients run simulation.
2024-08-15 09:27:54,822 - SimulatorClientRunner - INFO - Simulate Run client: site-1 on GPU group: None
2024-08-15 09:27:54,823 - SimulatorClientRunner - INFO - Simulate Run client: site-2 on GPU group: None
2024-08-15 09:27:56,948 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00005 127.0.0.1:53813 <= 127.0.0.1:53831] is created: PID: 71739
2024-08-15 09:27:56,949 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00006 127.0.0.1:53813 <= 127.0.0.1:53830] is created: PID: 71739
2024-08-15 09:27:57,792 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: assigned task to client site-1: name=train, id=b308736a-9e26-4573-9852-dd9b88444565
2024-08-15 09:27:57,794 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-2, peer_run=simulate_job, task_name=train, task_id=50f451e0-e6f7-468d-9e61-f29b1b9b0edd]: assigned task to client site-2: name=train, id=50f451e0-e6f7-468d-9e61-f29b1b9b0edd
2024-08-15 09:27:57,794 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: sent task assignment to client. client_name:site-1 task_id:b308736a-9e26-4573-9852-dd9b88444565
2024-08-15 09:27:57,794 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-2, peer_run=simulate_job, task_name=train, task_id=50f451e0-e6f7-468d-9e61-f29b1b9b0edd]: sent task assignment to client. client_name:site-2 task_id:50f451e0-e6f7-468d-9e61-f29b1b9b0edd
2024-08-15 09:27:57,795 - GetTaskCommand - INFO - return task to client.  client_name: site-1  task_name: train   task_id: b308736a-9e26-4573-9852-dd9b88444565  sharable_header_task_id: b308736a-9e26-4573-9852-dd9b88444565
2024-08-15 09:27:57,795 - GetTaskCommand - INFO - return task to client.  client_name: site-2  task_name: train   task_id: 50f451e0-e6f7-468d-9e61-f29b1b9b0edd  sharable_header_task_id: 50f451e0-e6f7-468d-9e61-f29b1b9b0edd
2024-08-15 09:27:59,859 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job]: got result from client site-1 for task: name=train, id=b308736a-9e26-4573-9852-dd9b88444565
2024-08-15 09:27:59,859 - WFCommServer - ERROR - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: processing error in result_received_cb on task train(b308736a-9e26-4573-9852-dd9b88444565): ValueError: the shareable is not a valid DXO - expect content_type DXO but got None
2024-08-15 09:27:59,860 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-2, peer_run=simulate_job]: got result from client site-2 for task: name=train, id=50f451e0-e6f7-468d-9e61-f29b1b9b0edd
2024-08-15 09:27:59,863 - WFCommServer - ERROR - Traceback (most recent call last):
  File "/Users/49751124/miniconda3/envs/nvflare/lib/python3.10/site-packages/nvflare/apis/impl/wf_comm_server.py", line 421, in _do_process_submission
    task.result_received_cb(client_task=client_task, fl_ctx=fl_ctx)
  File "/Users/49751124/miniconda3/envs/nvflare/lib/python3.10/site-packages/nvflare/app_common/workflows/base_model_controller.py", line 223, in _process_result
    result_model = FLModelUtils.from_shareable(result)
  File "/Users/49751124/miniconda3/envs/nvflare/lib/python3.10/site-packages/nvflare/app_common/utils/fl_model_utils.py", line 108, in from_shareable
    dxo = from_shareable(shareable)
  File "/Users/49751124/miniconda3/envs/nvflare/lib/python3.10/site-packages/nvflare/apis/dxo.py", line 168, in from_shareable
    raise ValueError("the shareable is not a valid DXO - expect content_type DXO but got {}".format(content_type))
ValueError: the shareable is not a valid DXO - expect content_type DXO but got None

2024-08-15 09:27:59,863 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: finished processing client result by controller
2024-08-15 09:27:59,863 - SubmitUpdateCommand - INFO - submit_update process. client_name:site-1   task_id:b308736a-9e26-4573-9852-dd9b88444565
2024-08-15 09:27:59,863 - WFCommServer - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-2, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=50f451e0-e6f7-468d-9e61-f29b1b9b0edd]: task is already finished - submission dropped
2024-08-15 09:27:59,864 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-2, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=50f451e0-e6f7-468d-9e61-f29b1b9b0edd]: finished processing client result by controller
2024-08-15 09:27:59,864 - SubmitUpdateCommand - INFO - submit_update process. client_name:site-2   task_id:50f451e0-e6f7-468d-9e61-f29b1b9b0edd
2024-08-15 09:27:59,917 - FedAvg - WARNING - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: Number of results (0) is different from number of expected responses (2).
2024-08-15 09:27:59,917 - FedAvg - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: aggregating 0 update(s) at round 0
2024-08-15 09:27:59,917 - FedAvg - ERROR - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: Exception in aggregate call: ValueError: received empty results for aggregation.
2024-08-15 09:27:59,918 - FedAvg - ERROR - Traceback (most recent call last):
  File "/Users/49751124/miniconda3/envs/nvflare/lib/python3.10/site-packages/nvflare/app_common/workflows/base_fedavg.py", line 130, in aggregate
    aggr_result = aggregate_fn(results)
  File "/Users/49751124/miniconda3/envs/nvflare/lib/python3.10/site-packages/nvflare/app_common/workflows/base_fedavg.py", line 82, in aggregate_fn
    raise ValueError("received empty results for aggregation.")
ValueError: received empty results for aggregation.

2024-08-15 09:27:59,918 - ServerRunner - ERROR - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: Aborting current RUN due to FATAL_SYSTEM_ERROR received: Exception in aggregate call: ValueError: received empty results for aggregation.
2024-08-15 09:27:59,918 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: asked to abort - triggered abort_signal to stop the RUN
2024-08-15 09:27:59,919 - FedAvg - ERROR - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: Exception in model controller run: RuntimeError: params_type None of `model_update` not supported!
2024-08-15 09:27:59,919 - FedAvg - ERROR - Traceback (most recent call last):
  File "/Users/49751124/miniconda3/envs/nvflare/lib/python3.10/site-packages/nvflare/app_common/workflows/base_model_controller.py", line 294, in control_flow
    self.run()
  File "/Users/49751124/miniconda3/envs/nvflare/lib/python3.10/site-packages/nvflare/app_common/workflows/fedavg.py", line 53, in run
    model = self.update_model(model, aggregate_results)
  File "/Users/49751124/miniconda3/envs/nvflare/lib/python3.10/site-packages/nvflare/app_common/workflows/base_fedavg.py", line 156, in update_model
    model = FLModelUtils.update_model(model, aggr_result)
  File "/Users/49751124/miniconda3/envs/nvflare/lib/python3.10/site-packages/nvflare/app_common/utils/fl_model_utils.py", line 239, in update_model
    raise RuntimeError(f"params_type {model_update.params_type} of `model_update` not supported!")
RuntimeError: params_type None of `model_update` not supported!

2024-08-15 09:27:59,919 - ServerRunner - ERROR - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: Aborting current RUN due to FATAL_SYSTEM_ERROR received: Exception in model controller run: RuntimeError: params_type None of `model_update` not supported!
2024-08-15 09:27:59,919 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job, peer_rc=TASK_ABORTED, task_name=train, task_id=b308736a-9e26-4573-9852-dd9b88444565]: asked to abort - triggered abort_signal to stop the RUN
2024-08-15 09:27:59,919 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: Workflow: controller finalizing ...
2024-08-15 09:27:59,920 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: ABOUT_TO_END_RUN fired
2024-08-15 09:27:59,920 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: Firing CHECK_END_RUN_READINESS ...
2024-08-15 09:27:59,921 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: END_RUN fired
2024-08-15 09:27:59,921 - ReliableMessage - INFO - ReliableMessage is shutdown
2024-08-15 09:27:59,921 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: Server runner finished.
2024-08-15 09:28:01,208 - ReliableMessage - INFO - shutdown reliable message monitor
2024-08-15 09:28:01,874 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-1, peer_run=simulate_job]: server runner is finalizing - asked client to end the run
2024-08-15 09:28:01,874 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller, peer=site-2, peer_run=simulate_job]: server runner is finalizing - asked client to end the run
2024-08-15 09:28:01,875 - GetTaskCommand - INFO - return task to client.  client_name: site-1  task_name: __end_run__   task_id:   sharable_header_task_id: 
2024-08-15 09:28:01,875 - GetTaskCommand - INFO - return task to client.  client_name: site-2  task_name: __end_run__   task_id:   sharable_header_task_id: 
2024-08-15 09:28:01,883 - FederatedClient - INFO - Shutting down client run: site-1
2024-08-15 09:28:01,884 - FederatedClient - INFO - Shutting down client run: site-2
2024-08-15 09:28:01,884 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00005 Not Connected] is closed PID: 71739
2024-08-15 09:28:01,884 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00006 Not Connected] is closed PID: 71739
2024-08-15 09:28:01,884 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=controller]: asked to abort - triggered abort_signal to stop the RUN
2024-08-15 09:28:02,200 - SimulatorServer - INFO - Server app stopped.


2024-08-15 09:28:02,290 - nvflare.fuel.hci.server.hci - INFO - Admin Server localhost on Port 53814 shutdown!
2024-08-15 09:28:02,291 - SimulatorServer - INFO - shutting down server
2024-08-15 09:28:02,291 - SimulatorServer - INFO - canceling sync locks
2024-08-15 09:28:02,291 - SimulatorServer - INFO - server off
2024-08-15 09:28:05,734 - MPM - WARNING - #### MPM: still running thread Thread-8
2024-08-15 09:28:05,735 - MPM - INFO - MPM: Good Bye!
